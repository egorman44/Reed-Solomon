name: 'Cocotb Simulation'
description: 'Runs cocotb for RsDecoder.'
runs:
  using: "composite"
  steps:
    - name: Install Dependencies
      run: |
        ls
        sudo apt-get update
        sudo apt-get install -y libunwind-dev
        sudo apt-get install -y git help2man perl make autoconf g++ flex libfl-dev bison ccache numactl perl-doc

    - name: Install Verilator
      if: steps.verilator-cache.outputs.cache-hit != 'true'
      run: |
        git clone https://github.com/verilator/verilator.git  
        cd verilator  
        git checkout v5.022  
        autoconf  
        ./configure  
        make -j$(nproc)  
        sudo make install
        rm -rf verilator

    - name: Set up Python 3.10
      uses: actions/setup-python@v2
      with:
        python-version: '3.10'

    - name: Install Python packages
      run: |
        pip install cocotb==1.8.1
        pip install reedsolo

    - name: run sim
      working-directory: ./coco_sim
      run: |
        python3 rs_decoder.py -l RsBlockRecovery
